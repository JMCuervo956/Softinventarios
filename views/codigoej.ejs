<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escanear Código de Barras</title>
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
</head>
<body>

<h2>Escanear Código de Barras</h2>

<video id="barcode-scanner" autoplay></video>

<script>
    // Asegúrate de que Quagga se inicializa correctamente con la cámara trasera
    function startScanner() {
        // Verifica si la cámara está disponible
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({
                video: { facingMode: "environment" }
            })
            .then(function (stream) {
                const video = document.getElementById('barcode-scanner');
                video.srcObject = stream;

                // Inicializa Quagga
                Quagga.init({
                    inputStream: {
                        type: "LiveStream",
                        target: video, // Aquí usamos el video de la cámara
                    },
                    decoder: {
                        readers: ["code_128_reader", "ean_reader", "ean_8_reader", "upc_reader"]
                    }
                }, function(err) {
                    if (err) {
                        console.error(err);
                        return;
                    }
                    Quagga.start(); // Comienza el escaneo
                });
            })
            .catch(function (err) {
                console.log("Error al acceder a la cámara: " + err);
            });
        } else {
            alert("El navegador no soporta la cámara");
        }
    }

    window.onload = function() {
        startScanner();
    };
</script>

</body>
</html>
