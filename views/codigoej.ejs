<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escanear Código de Barras</title>
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }

        #scanner-container {
            width: 100%;
            height: 100vh;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            position: relative;
        }

        #result {
            font-size: 18px;
            margin-top: 20px;
            color: #333;
        }

        #status {
            font-size: 18px;
            color: #f44336;
        }

        h2 {
            color: #333;
        }

        #start-button {
            padding: 10px 20px;
            background-color: #4caf50;
            color: white;
            border: none;
            cursor: pointer;
            margin: 20px 0;
        }

        #start-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .feedback {
            font-size: 18px;
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <h2>Escanear Código de Barras</h2>
    
    <!-- Contenedor para la cámara -->
    <div id="scanner-container"></div>
    
    <!-- Resultados del escaneo -->
    <p>El código escaneado es: <span id="result">Esperando...</span></p>
    <p id="status">Esperando el escaneo...</p>
    
    <!-- Botón para iniciar el escaneo -->
    <button id="start-button">Iniciar Escaneo</button>

    <div class="feedback" id="feedback"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const startButton = document.getElementById('start-button');
            const resultElement = document.getElementById('result');
            const statusElement = document.getElementById('status');
            const feedbackElement = document.getElementById('feedback');

            // Verificamos si el navegador soporta el acceso a la cámara
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                console.log('Cámara accesible');
                startButton.disabled = false;  // Habilitamos el botón de inicio de escaneo

                // Al hacer clic en el botón, iniciar el escaneo
                startButton.addEventListener('click', function () {
                    // Inicializamos QuaggaJS
                    Quagga.init({
                        inputStream: {
                            name: "Live",
                            type: "LiveStream",
                            target: document.querySelector('#scanner-container'),  // El contenedor donde se muestra el video
                            constraints: {
                                facingMode: "environment"  // Cámara trasera del dispositivo
                            },
                            area: {
                                top: "0%",    // Especificamos la región para el escaneo
                                left: "0%",
                                width: "100%",
                                height: "100%"
                            }
                        },
                        decoder: {
                            readers: [
                                "code_128_reader",
                                "ean_reader",
                                "ean_8_reader",
                                "upc_reader",
                                "code_39_reader",
                                "code_93_reader",
                                "codabar_reader",
                                "itf_reader"
                            ]
                        }
                    }, function(err) {
                        if (err) {
                            console.error("Error de Quagga:", err);
                            statusElement.textContent = "Error al acceder a la cámara. Revisa los permisos.";
                            statusElement.style.color = "#f44336";
                            feedbackElement.textContent = "Asegúrate de permitir acceso a la cámara.";
                            feedbackElement.style.color = "#f44336";
                            return;
                        }
                        console.log("Cámara inicializada.");
                        Quagga.start();  // Iniciamos el escaneo
                        statusElement.textContent = "Escaneando...";
                        feedbackElement.textContent = "";
                    });

                    // Función de escaneo exitoso
                    Quagga.onDetected(function(result) {
                        console.log("Código detectado:", result.codeResult.code);
                        resultElement.textContent = result.codeResult.code;  // Mostrar el código detectado
                        statusElement.textContent = "¡Escaneo exitoso!";  // Mensaje de éxito
                        statusElement.style.color = "#4caf50";  // Cambiar color a verde (para éxito)
                        feedbackElement.textContent = "¡Código detectado exitosamente!";
                        feedbackElement.style.color = "#4caf50";  // Color verde para el éxito
                    });
                    
                    // Si no se detecta ningún código, mostrar mensaje de error
                    Quagga.onProcessed(function(result) {
                        if (result && result.codeResult && result.codeResult.code === null) {
                            statusElement.textContent = "Escaneo fallido, intenta de nuevo.";
                            statusElement.style.color = "#f44336";  // Rojo
                            feedbackElement.textContent = "No se detectó ningún código. Intenta nuevamente.";
                            feedbackElement.style.color = "#f44336";  // Rojo
                        }
                    });
                });
                
            } else {
                console.error("El navegador no tiene soporte para la cámara.");
                statusElement.textContent = "El navegador no tiene soporte para la cámara.";
                statusElement.style.color = "#f44336";
                startButton.disabled = true;  // Deshabilitamos el botón si no hay soporte para la cámara
            }
        });
    </script>

</body>
</html>
